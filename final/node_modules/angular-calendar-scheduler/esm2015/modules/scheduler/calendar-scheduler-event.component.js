/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, TemplateRef, Renderer2 } from '@angular/core';
import { isSameDay } from 'date-fns';
import * as momentImported from 'moment';
/** @type {?} */
const moment = momentImported;
/**
 * [mwlCalendarTooltip]="event.title | calendarEventTitle:'weekTooltip':event"
 * [tooltipPlacement]="tooltipPlacement"
 */
export class CalendarSchedulerEventComponent {
    /**
     * @param {?} renderer
     */
    constructor(renderer) {
        this.renderer = renderer;
        this.showActions = true;
        this.eventClicked = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.segment.hasBorder = this.hour.hasBorder = !this.event.endsAfterSegment;
        this.title = moment(this.event.start).format('dddd L');
        this.checkEnableState();
    }
    /**
     * @return {?}
     */
    checkEnableState() {
        if (this.segment.isDisabled) {
            this.day.hours.forEach((hour) => {
                hour.segments.forEach((segment) => {
                    segment.events.filter((event) => event.id === this.event.id && isSameDay(event.start, this.event.start))
                        .forEach((event) => {
                        event.isDisabled = true;
                    });
                });
            });
        }
    }
    /**
     * @return {?}
     */
    highlightEvent() {
        // let events: CalendarSchedulerEvent[] = this.day.hours
        //    .filter(h => h.segments.some(s => s.events.some(e => e.id === this.event.id)))
        //    .map(h =>
        //        h.segments.map(s =>
        //            s.events.filter(e => e.id === this.event.id)
        //        ).reduce((prev, curr) => prev.concat(curr))
        //    )
        //    .reduce((prev, curr) => prev.concat(curr));
        this.day.hours.forEach((hour) => {
            hour.segments.forEach((segment) => {
                segment.events.filter((event) => event.id === this.event.id && isSameDay(event.start, this.event.start))
                    .forEach((event) => {
                    event.isHovered = true;
                });
            });
        });
    }
    /**
     * @return {?}
     */
    unhighlightEvent() {
        this.day.hours.forEach((hour) => {
            hour.segments.forEach((segment) => {
                segment.events.filter((event) => event.id === this.event.id && isSameDay(event.start, this.event.start))
                    .forEach((event) => {
                    event.isHovered = false;
                });
            });
        });
    }
}
CalendarSchedulerEventComponent.decorators = [
    { type: Component, args: [{
                selector: 'calendar-scheduler-event',
                template: `
        <ng-template #defaultTemplate>
            <div
                class="cal-scheduler-event"
                [title]="title"
                [class.cal-starts-within-segment]="!event.startsBeforeSegment"
                [class.cal-ends-within-segment]="!event.endsAfterSegment"
                [class.hovered]="event.isHovered"
                [class.cal-disabled]="event.isDisabled || segment.isDisabled"
                [class.cal-not-clickable]="!event.isClickable"
                [style.backgroundColor]="event.color.primary"
                [ngClass]="event?.cssClass"
                (mwlClick)="eventClicked.emit({event: event})"
                (mouseenter)="highlightEvent()"
                (mouseleave)="unhighlightEvent()">
                <calendar-scheduler-event-title *ngIf="!event.startsBeforeSegment"
                    [event]="event"
                    view="week">
                </calendar-scheduler-event-title>
                <calendar-scheduler-event-content *ngIf="!event.startsBeforeSegment"
                    [event]="event">
                </calendar-scheduler-event-content>
                <calendar-scheduler-event-actions [event]="event" *ngIf="showActions && event.isClickable && !event.endsAfterSegment"></calendar-scheduler-event-actions>
                <calendar-scheduler-event-actions [event]="event" *ngIf="showActions && event.isDisabled && !event.endsAfterSegment"></calendar-scheduler-event-actions>
            </div>
        </ng-template>
        <ng-template
            [ngTemplateOutlet]="customTemplate || defaultTemplate"
            [ngTemplateOutletContext]="{
                day: day,
                hour: hour,
                segment: segment,
                event: event,
                tooltipPlacement: tooltipPlacement,
                showActions: showActions,
                customTemplate: customTemplate,
                eventClicked: eventClicked
            }">
        </ng-template>
    `,
                host: {
                    'class': 'cal-scheduler-event-container'
                }
            },] },
];
/** @nocollapse */
CalendarSchedulerEventComponent.ctorParameters = () => [
    { type: Renderer2 }
];
CalendarSchedulerEventComponent.propDecorators = {
    title: [{ type: Input }],
    day: [{ type: Input }],
    hour: [{ type: Input }],
    segment: [{ type: Input }],
    event: [{ type: Input }],
    tooltipPlacement: [{ type: Input }],
    showActions: [{ type: Input }],
    customTemplate: [{ type: Input }],
    eventClicked: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.title;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.day;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.hour;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.segment;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.event;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.tooltipPlacement;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.showActions;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.customTemplate;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.eventClicked;
    /** @type {?} */
    CalendarSchedulerEventComponent.prototype.renderer;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsZW5kYXItc2NoZWR1bGVyLWV2ZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItY2FsZW5kYXItc2NoZWR1bGVyLyIsInNvdXJjZXMiOlsibW9kdWxlcy9zY2hlZHVsZXIvY2FsZW5kYXItc2NoZWR1bGVyLWV2ZW50LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQVUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBT3ZHLE9BQU8sRUFDSCxTQUFTLEVBQ1osTUFBTSxVQUFVLENBQUM7QUFHbEIsT0FBTyxLQUFLLGNBQWMsTUFBTSxRQUFRLENBQUM7O0FBQ3pDLE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQzs7Ozs7QUFvRDlCLE1BQU07Ozs7SUFvQkYsWUFBb0IsUUFBbUI7UUFBbkIsYUFBUSxHQUFSLFFBQVEsQ0FBVzsyQkFOUCxJQUFJOzRCQUlzQyxJQUFJLFlBQVksRUFBcUM7S0FFakY7Ozs7SUFFdkMsUUFBUTtRQUNYLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQztRQUU1RSxJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUV2RCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQzs7Ozs7SUFHcEIsZ0JBQWdCO1FBQ3BCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUF1QixFQUFFLEVBQUU7Z0JBQy9DLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBaUMsRUFBRSxFQUFFO29CQUN4RCxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQTZCLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQzt5QkFDM0gsT0FBTyxDQUFDLENBQUMsS0FBNkIsRUFBRSxFQUFFO3dCQUN2QyxLQUFLLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztxQkFDM0IsQ0FBQyxDQUFDO2lCQUNWLENBQUMsQ0FBQzthQUNOLENBQUMsQ0FBQztTQUNOOzs7OztJQUdMLGNBQWM7Ozs7Ozs7OztRQVVWLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQXVCLEVBQUUsRUFBRTtZQUMvQyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQWlDLEVBQUUsRUFBRTtnQkFDeEQsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUE2QixFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7cUJBQzNILE9BQU8sQ0FBQyxDQUFDLEtBQTZCLEVBQUUsRUFBRTtvQkFDdkMsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7aUJBQzFCLENBQUMsQ0FBQzthQUNWLENBQUMsQ0FBQztTQUNOLENBQUMsQ0FBQztLQUNOOzs7O0lBRUQsZ0JBQWdCO1FBQ1osSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBdUIsRUFBRSxFQUFFO1lBQy9DLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBaUMsRUFBRSxFQUFFO2dCQUN4RCxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQTZCLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztxQkFDM0gsT0FBTyxDQUFDLENBQUMsS0FBNkIsRUFBRSxFQUFFO29CQUN2QyxLQUFLLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztpQkFDM0IsQ0FBQyxDQUFDO2FBQ1YsQ0FBQyxDQUFDO1NBQ04sQ0FBQyxDQUFDO0tBQ047OztZQXRISixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLDBCQUEwQjtnQkFDcEMsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7S0F1Q1Q7Z0JBQ0QsSUFBSSxFQUFFO29CQUNGLE9BQU8sRUFBRSwrQkFBK0I7aUJBQzNDO2FBQ0o7Ozs7WUFoRXFFLFNBQVM7OztvQkFtRTFFLEtBQUs7a0JBRUwsS0FBSzttQkFFTCxLQUFLO3NCQUVMLEtBQUs7b0JBRUwsS0FBSzsrQkFFTCxLQUFLOzBCQUVMLEtBQUs7NkJBRUwsS0FBSzsyQkFFTCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFRlbXBsYXRlUmVmLCBPbkluaXQsIFJlbmRlcmVyMiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge1xyXG4gICAgU2NoZWR1bGVyVmlld0RheSxcclxuICAgIFNjaGVkdWxlclZpZXdIb3VyLFxyXG4gICAgU2NoZWR1bGVyVmlld0hvdXJTZWdtZW50LFxyXG4gICAgQ2FsZW5kYXJTY2hlZHVsZXJFdmVudFxyXG59IGZyb20gJy4vY2FsZW5kYXItc2NoZWR1bGVyLXZpZXcuY29tcG9uZW50JztcclxuaW1wb3J0IHtcclxuICAgIGlzU2FtZURheVxyXG59IGZyb20gJ2RhdGUtZm5zJztcclxuXHJcbi8vIFdPUktBUk9VTkQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9kaGVyZ2VzL25nLXBhY2thZ3IvaXNzdWVzLzIxNyNpc3N1ZWNvbW1lbnQtMzM5NDYwMjU1XHJcbmltcG9ydCAqIGFzIG1vbWVudEltcG9ydGVkIGZyb20gJ21vbWVudCc7XHJcbmNvbnN0IG1vbWVudCA9IG1vbWVudEltcG9ydGVkO1xyXG5cclxuLyoqXHJcbiAqIFttd2xDYWxlbmRhclRvb2x0aXBdPVwiZXZlbnQudGl0bGUgfCBjYWxlbmRhckV2ZW50VGl0bGU6J3dlZWtUb29sdGlwJzpldmVudFwiXHJcbiAqIFt0b29sdGlwUGxhY2VtZW50XT1cInRvb2x0aXBQbGFjZW1lbnRcIlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2NhbGVuZGFyLXNjaGVkdWxlci1ldmVudCcsXHJcbiAgICB0ZW1wbGF0ZTogYFxyXG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjZGVmYXVsdFRlbXBsYXRlPlxyXG4gICAgICAgICAgICA8ZGl2XHJcbiAgICAgICAgICAgICAgICBjbGFzcz1cImNhbC1zY2hlZHVsZXItZXZlbnRcIlxyXG4gICAgICAgICAgICAgICAgW3RpdGxlXT1cInRpdGxlXCJcclxuICAgICAgICAgICAgICAgIFtjbGFzcy5jYWwtc3RhcnRzLXdpdGhpbi1zZWdtZW50XT1cIiFldmVudC5zdGFydHNCZWZvcmVTZWdtZW50XCJcclxuICAgICAgICAgICAgICAgIFtjbGFzcy5jYWwtZW5kcy13aXRoaW4tc2VnbWVudF09XCIhZXZlbnQuZW5kc0FmdGVyU2VnbWVudFwiXHJcbiAgICAgICAgICAgICAgICBbY2xhc3MuaG92ZXJlZF09XCJldmVudC5pc0hvdmVyZWRcIlxyXG4gICAgICAgICAgICAgICAgW2NsYXNzLmNhbC1kaXNhYmxlZF09XCJldmVudC5pc0Rpc2FibGVkIHx8IHNlZ21lbnQuaXNEaXNhYmxlZFwiXHJcbiAgICAgICAgICAgICAgICBbY2xhc3MuY2FsLW5vdC1jbGlja2FibGVdPVwiIWV2ZW50LmlzQ2xpY2thYmxlXCJcclxuICAgICAgICAgICAgICAgIFtzdHlsZS5iYWNrZ3JvdW5kQ29sb3JdPVwiZXZlbnQuY29sb3IucHJpbWFyeVwiXHJcbiAgICAgICAgICAgICAgICBbbmdDbGFzc109XCJldmVudD8uY3NzQ2xhc3NcIlxyXG4gICAgICAgICAgICAgICAgKG13bENsaWNrKT1cImV2ZW50Q2xpY2tlZC5lbWl0KHtldmVudDogZXZlbnR9KVwiXHJcbiAgICAgICAgICAgICAgICAobW91c2VlbnRlcik9XCJoaWdobGlnaHRFdmVudCgpXCJcclxuICAgICAgICAgICAgICAgIChtb3VzZWxlYXZlKT1cInVuaGlnaGxpZ2h0RXZlbnQoKVwiPlxyXG4gICAgICAgICAgICAgICAgPGNhbGVuZGFyLXNjaGVkdWxlci1ldmVudC10aXRsZSAqbmdJZj1cIiFldmVudC5zdGFydHNCZWZvcmVTZWdtZW50XCJcclxuICAgICAgICAgICAgICAgICAgICBbZXZlbnRdPVwiZXZlbnRcIlxyXG4gICAgICAgICAgICAgICAgICAgIHZpZXc9XCJ3ZWVrXCI+XHJcbiAgICAgICAgICAgICAgICA8L2NhbGVuZGFyLXNjaGVkdWxlci1ldmVudC10aXRsZT5cclxuICAgICAgICAgICAgICAgIDxjYWxlbmRhci1zY2hlZHVsZXItZXZlbnQtY29udGVudCAqbmdJZj1cIiFldmVudC5zdGFydHNCZWZvcmVTZWdtZW50XCJcclxuICAgICAgICAgICAgICAgICAgICBbZXZlbnRdPVwiZXZlbnRcIj5cclxuICAgICAgICAgICAgICAgIDwvY2FsZW5kYXItc2NoZWR1bGVyLWV2ZW50LWNvbnRlbnQ+XHJcbiAgICAgICAgICAgICAgICA8Y2FsZW5kYXItc2NoZWR1bGVyLWV2ZW50LWFjdGlvbnMgW2V2ZW50XT1cImV2ZW50XCIgKm5nSWY9XCJzaG93QWN0aW9ucyAmJiBldmVudC5pc0NsaWNrYWJsZSAmJiAhZXZlbnQuZW5kc0FmdGVyU2VnbWVudFwiPjwvY2FsZW5kYXItc2NoZWR1bGVyLWV2ZW50LWFjdGlvbnM+XHJcbiAgICAgICAgICAgICAgICA8Y2FsZW5kYXItc2NoZWR1bGVyLWV2ZW50LWFjdGlvbnMgW2V2ZW50XT1cImV2ZW50XCIgKm5nSWY9XCJzaG93QWN0aW9ucyAmJiBldmVudC5pc0Rpc2FibGVkICYmICFldmVudC5lbmRzQWZ0ZXJTZWdtZW50XCI+PC9jYWxlbmRhci1zY2hlZHVsZXItZXZlbnQtYWN0aW9ucz5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cclxuICAgICAgICA8bmctdGVtcGxhdGVcclxuICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRdPVwiY3VzdG9tVGVtcGxhdGUgfHwgZGVmYXVsdFRlbXBsYXRlXCJcclxuICAgICAgICAgICAgW25nVGVtcGxhdGVPdXRsZXRDb250ZXh0XT1cIntcclxuICAgICAgICAgICAgICAgIGRheTogZGF5LFxyXG4gICAgICAgICAgICAgICAgaG91cjogaG91cixcclxuICAgICAgICAgICAgICAgIHNlZ21lbnQ6IHNlZ21lbnQsXHJcbiAgICAgICAgICAgICAgICBldmVudDogZXZlbnQsXHJcbiAgICAgICAgICAgICAgICB0b29sdGlwUGxhY2VtZW50OiB0b29sdGlwUGxhY2VtZW50LFxyXG4gICAgICAgICAgICAgICAgc2hvd0FjdGlvbnM6IHNob3dBY3Rpb25zLFxyXG4gICAgICAgICAgICAgICAgY3VzdG9tVGVtcGxhdGU6IGN1c3RvbVRlbXBsYXRlLFxyXG4gICAgICAgICAgICAgICAgZXZlbnRDbGlja2VkOiBldmVudENsaWNrZWRcclxuICAgICAgICAgICAgfVwiPlxyXG4gICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAgICBgLFxyXG4gICAgaG9zdDoge1xyXG4gICAgICAgICdjbGFzcyc6ICdjYWwtc2NoZWR1bGVyLWV2ZW50LWNvbnRhaW5lcidcclxuICAgIH1cclxufSlcclxuZXhwb3J0IGNsYXNzIENhbGVuZGFyU2NoZWR1bGVyRXZlbnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG5cclxuICAgIEBJbnB1dCgpIHRpdGxlOiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgZGF5OiBTY2hlZHVsZXJWaWV3RGF5O1xyXG5cclxuICAgIEBJbnB1dCgpIGhvdXI6IFNjaGVkdWxlclZpZXdIb3VyO1xyXG5cclxuICAgIEBJbnB1dCgpIHNlZ21lbnQ6IFNjaGVkdWxlclZpZXdIb3VyU2VnbWVudDtcclxuXHJcbiAgICBASW5wdXQoKSBldmVudDogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudDtcclxuXHJcbiAgICBASW5wdXQoKSB0b29sdGlwUGxhY2VtZW50OiBzdHJpbmc7XHJcblxyXG4gICAgQElucHV0KCkgc2hvd0FjdGlvbnM6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIEBJbnB1dCgpIGN1c3RvbVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xyXG5cclxuICAgIEBPdXRwdXQoKSBldmVudENsaWNrZWQ6IEV2ZW50RW1pdHRlcjx7IGV2ZW50OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50IH0+ID0gbmV3IEV2ZW50RW1pdHRlcjx7IGV2ZW50OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50IH0+KCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7ICAgfVxyXG5cclxuICAgIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNlZ21lbnQuaGFzQm9yZGVyID0gdGhpcy5ob3VyLmhhc0JvcmRlciA9ICF0aGlzLmV2ZW50LmVuZHNBZnRlclNlZ21lbnQ7XHJcblxyXG4gICAgICAgIHRoaXMudGl0bGUgPSBtb21lbnQodGhpcy5ldmVudC5zdGFydCkuZm9ybWF0KCdkZGRkIEwnKTtcclxuXHJcbiAgICAgICAgdGhpcy5jaGVja0VuYWJsZVN0YXRlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja0VuYWJsZVN0YXRlKCk6IHZvaWQge1xyXG4gICAgICAgIGlmICh0aGlzLnNlZ21lbnQuaXNEaXNhYmxlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmRheS5ob3Vycy5mb3JFYWNoKChob3VyOiBTY2hlZHVsZXJWaWV3SG91cikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaG91ci5zZWdtZW50cy5mb3JFYWNoKChzZWdtZW50OiBTY2hlZHVsZXJWaWV3SG91clNlZ21lbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzZWdtZW50LmV2ZW50cy5maWx0ZXIoKGV2ZW50OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50KSA9PiBldmVudC5pZCA9PT0gdGhpcy5ldmVudC5pZCAmJiBpc1NhbWVEYXkoZXZlbnQuc3RhcnQsIHRoaXMuZXZlbnQuc3RhcnQpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaCgoZXZlbnQ6IENhbGVuZGFyU2NoZWR1bGVyRXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LmlzRGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaGlnaGxpZ2h0RXZlbnQoKTogdm9pZCB7XHJcbiAgICAgICAgLy8gbGV0IGV2ZW50czogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudFtdID0gdGhpcy5kYXkuaG91cnNcclxuICAgICAgICAvLyAgICAuZmlsdGVyKGggPT4gaC5zZWdtZW50cy5zb21lKHMgPT4gcy5ldmVudHMuc29tZShlID0+IGUuaWQgPT09IHRoaXMuZXZlbnQuaWQpKSlcclxuICAgICAgICAvLyAgICAubWFwKGggPT5cclxuICAgICAgICAvLyAgICAgICAgaC5zZWdtZW50cy5tYXAocyA9PlxyXG4gICAgICAgIC8vICAgICAgICAgICAgcy5ldmVudHMuZmlsdGVyKGUgPT4gZS5pZCA9PT0gdGhpcy5ldmVudC5pZClcclxuICAgICAgICAvLyAgICAgICAgKS5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IHByZXYuY29uY2F0KGN1cnIpKVxyXG4gICAgICAgIC8vICAgIClcclxuICAgICAgICAvLyAgICAucmVkdWNlKChwcmV2LCBjdXJyKSA9PiBwcmV2LmNvbmNhdChjdXJyKSk7XHJcblxyXG4gICAgICAgIHRoaXMuZGF5LmhvdXJzLmZvckVhY2goKGhvdXI6IFNjaGVkdWxlclZpZXdIb3VyKSA9PiB7XHJcbiAgICAgICAgICAgIGhvdXIuc2VnbWVudHMuZm9yRWFjaCgoc2VnbWVudDogU2NoZWR1bGVyVmlld0hvdXJTZWdtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzZWdtZW50LmV2ZW50cy5maWx0ZXIoKGV2ZW50OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50KSA9PiBldmVudC5pZCA9PT0gdGhpcy5ldmVudC5pZCAmJiBpc1NhbWVEYXkoZXZlbnQuc3RhcnQsIHRoaXMuZXZlbnQuc3RhcnQpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChldmVudDogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5pc0hvdmVyZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICB1bmhpZ2hsaWdodEV2ZW50KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGF5LmhvdXJzLmZvckVhY2goKGhvdXI6IFNjaGVkdWxlclZpZXdIb3VyKSA9PiB7XHJcbiAgICAgICAgICAgIGhvdXIuc2VnbWVudHMuZm9yRWFjaCgoc2VnbWVudDogU2NoZWR1bGVyVmlld0hvdXJTZWdtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBzZWdtZW50LmV2ZW50cy5maWx0ZXIoKGV2ZW50OiBDYWxlbmRhclNjaGVkdWxlckV2ZW50KSA9PiBldmVudC5pZCA9PT0gdGhpcy5ldmVudC5pZCAmJiBpc1NhbWVEYXkoZXZlbnQuc3RhcnQsIHRoaXMuZXZlbnQuc3RhcnQpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKChldmVudDogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudC5pc0hvdmVyZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcHJpdmF0ZSBzYW1lRXZlbnRJblByZXZpb3VzSG91cihkYXk6IFNjaGVkdWxlclZpZXdEYXksIGhvdXI6IFNjaGVkdWxlclZpZXdIb3VyKTogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCB7XHJcbiAgICAvLyAgICBsZXQgaG91ckluZGV4OiBudW1iZXIgPSBkYXkuaG91cnMuaW5kZXhPZihob3VyKTtcclxuICAgIC8vICAgIGxldCBwcmV2aW91c0hvdXIgPSBkYXkuaG91cnNbaG91ckluZGV4IC0gMV07XHJcbiAgICAvLyAgICBpZiAocHJldmlvdXNIb3VyKSB7XHJcbiAgICAvLyAgICAgICAgbGV0IHByZXZpb3VzU2VnbWVudDogU2NoZWR1bGVyVmlld0hvdXJTZWdtZW50ID0gcHJldmlvdXNIb3VyLnNlZ21lbnRzW3ByZXZpb3VzSG91ci5zZWdtZW50cy5sZW5ndGggLSAxXTtcclxuICAgIC8vICAgICAgICByZXR1cm4gcHJldmlvdXNTZWdtZW50LmV2ZW50c1twcmV2aW91c1NlZ21lbnQuZXZlbnRzLmxlbmd0aCAtIDFdO1xyXG4gICAgLy8gICAgfVxyXG4gICAgLy8gICAgcmV0dXJuIG51bGw7XHJcbiAgICAvLyB9XHJcblxyXG4gICAgLy8gcHJpdmF0ZSBzYW1lRXZlbnRJblByZXZpb3VzU2VnbWVudChzZWdtZW50SW5kZXg6IG51bWJlcik6IENhbGVuZGFyU2NoZWR1bGVyRXZlbnQge1xyXG4gICAgLy8gICAgbGV0IHByZXZpb3VzU2VnbWVudDogU2NoZWR1bGVyVmlld0hvdXJTZWdtZW50ID0gdGhpcy5ob3VyLnNlZ21lbnRzW3NlZ21lbnRJbmRleCAtIDFdO1xyXG4gICAgLy8gICAgaWYgKHByZXZpb3VzU2VnbWVudCkge1xyXG4gICAgLy8gICAgICAgIHJldHVybiBwcmV2aW91c1NlZ21lbnQuZXZlbnRzW3ByZXZpb3VzU2VnbWVudC5ldmVudHMubGVuZ3RoIC0gMV07XHJcbiAgICAvLyAgICB9XHJcbiAgICAvLyAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBwcml2YXRlIHNhbWVFdmVudEluTmV4dEhvdXIoKTogQ2FsZW5kYXJTY2hlZHVsZXJFdmVudCB7XHJcbiAgICAvLyAgICBsZXQgaG91ckluZGV4OiBudW1iZXIgPSB0aGlzLmRheS5ob3Vycy5pbmRleE9mKHRoaXMuaG91cik7XHJcbiAgICAvLyAgICBsZXQgbmV4dEhvdXI6IFNjaGVkdWxlclZpZXdIb3VyID0gdGhpcy5kYXkuaG91cnNbaG91ckluZGV4ICsgMV07XHJcbiAgICAvLyAgICBpZiAobmV4dEhvdXIpIHtcclxuICAgIC8vICAgICAgICBsZXQgbmV4dFNlZ21lbnQ6IFNjaGVkdWxlclZpZXdIb3VyU2VnbWVudCA9IG5leHRIb3VyLnNlZ21lbnRzWzBdO1xyXG4gICAgLy8gICAgICAgIHJldHVybiBuZXh0U2VnbWVudC5ldmVudHNbMF07XHJcbiAgICAvLyAgICB9XHJcbiAgICAvLyAgICByZXR1cm4gbnVsbDtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvLyBwcml2YXRlIHNhbWVFdmVudEluTmV4dFNlZ21lbnQoc2VnbWVudEluZGV4OiBudW1iZXIpOiBDYWxlbmRhclNjaGVkdWxlckV2ZW50IHtcclxuICAgIC8vICAgIGxldCBuZXh0U2VnbWVudDogU2NoZWR1bGVyVmlld0hvdXJTZWdtZW50ID0gdGhpcy5ob3VyLnNlZ21lbnRzW3NlZ21lbnRJbmRleCArIDFdO1xyXG4gICAgLy8gICAgaWYgKG5leHRTZWdtZW50KSB7XHJcbiAgICAvLyAgICAgICAgcmV0dXJuIG5leHRTZWdtZW50LmV2ZW50c1swXTtcclxuICAgIC8vICAgIH1cclxuICAgIC8vICAgIHJldHVybiBudWxsO1xyXG4gICAgLy8gfVxyXG59XHJcbiJdfQ==